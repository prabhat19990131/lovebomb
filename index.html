<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For You ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            background: linear-gradient(180deg, #ffdde1 0%, #ee9ca7 100%);
            touch-action: manipulation; /* Improves touch response */
            height: 100dvh; /* Fix for mobile browser address bars */
        }
        
        h1, h2 {
            font-family: 'Dancing Script', cursive;
        }

        .btn-shadow {
            box-shadow: 0 10px 15px -3px rgba(255, 65, 108, 0.3), 0 4px 6px -2px rgba(255, 65, 108, 0.1);
        }

        /* Pulse animation for the main container */
        @keyframes float-gentle {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .float {
            animation: float-gentle 3s ease-in-out infinite;
        }

        /* Heartbeat */
        @keyframes pound {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .pound {
            animation: pound 0.8s infinite;
        }

        /* Canvas for effects */
        #effects-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .hidden-transition {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease-out;
            pointer-events: none;
        }

        .visible-transition {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
    </style>
</head>
<body class="w-screen flex flex-col items-center justify-center relative select-none">

    <canvas id="effects-canvas"></canvas>

    <div id="proposal-card" class="z-20 bg-white/90 backdrop-blur-md p-8 sm:p-10 md:p-14 rounded-[2rem] shadow-2xl w-[90%] max-w-md md:max-w-2xl text-center border-4 border-pink-200 float transition-all duration-500 relative">
        
        <div class="mb-4 text-6xl sm:text-7xl md:text-9xl animate-bounce">
            üíå
        </div>

        <h1 class="text-4xl sm:text-5xl md:text-7xl text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-600 mb-4 font-bold leading-tight py-2">
            Will you be my Valentine?
        </h1>
        
        <p class="text-gray-500 text-lg sm:text-xl md:text-2xl mb-8 font-semibold">Please say yes! ü•∫ üëÄ</p>
        
        <div class="flex flex-col md:flex-row justify-center items-center gap-6 md:gap-8 w-full min-h-[8rem]">
            <button id="yesBtn" 
                class="w-full md:w-auto min-w-[140px] bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-black py-4 px-8 md:px-12 rounded-full text-xl md:text-2xl shadow-xl transform transition hover:scale-105 active:scale-95 border-b-4 border-pink-700 z-10">
                YES! üòç
            </button>

            <button id="noBtn" 
                class="w-full md:w-auto min-w-[140px] bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-4 px-8 md:px-12 rounded-full text-lg md:text-xl shadow-lg border-b-4 border-gray-400 transition-all duration-100 ease-out touch-none">
                No üò¢
            </button>
            
            <div id="noBubble" class="absolute opacity-0 transition-opacity duration-200 pointer-events-none z-50">
                <div class="relative bg-gray-800 text-white text-xs sm:text-sm font-bold px-3 py-2 rounded-lg shadow-lg whitespace-nowrap">
                    <span id="bubbleText">Too slow!</span>
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"></div>
                </div>
            </div>
        </div>

        <div class="mt-6 flex justify-center w-full">
            <button id="resetGameBtn" onclick="location.reload()" 
                class="hidden w-full md:w-auto min-w-[140px] bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold py-3 px-8 rounded-full text-lg shadow-lg transform transition hover:scale-105 active:scale-95 border-b-4 border-gray-400 z-10">
                Want a chance to say no?
            </button>
        </div>
    </div>

    <div id="success-msg" class="fixed inset-0 z-30 flex flex-col items-center justify-center hidden-transition bg-white/30 backdrop-blur-sm p-4">
        
        <div class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl text-center border-8 border-pink-300 transform rotate-2 w-full max-w-md md:max-w-xl max-h-[90vh] overflow-y-auto">
            <h1 class="text-5xl sm:text-6xl md:text-8xl text-pink-600 mb-4 pound">YAY!!! üéâ</h1>
            <p class="text-xl sm:text-2xl md:text-4xl text-gray-800 font-bold mb-8">You're officially mine now! ‚ù§Ô∏è</p>
            
            <div class="text-5xl sm:text-6xl md:text-7xl animate-pulse tracking-widest mb-6">
                üë©‚Äç‚ù§Ô∏è‚Äçüë® üíç üíí
            </div>
            
            <p class="mt-4 text-pink-400 text-xs sm:text-sm font-bold uppercase tracking-widest">No Returns ‚Ä¢ No Refunds</p>
            
            <div class="mt-8 p-4 bg-pink-100 rounded-xl border-2 border-pink-200 animate-bounce">
                <p class="text-lg sm:text-xl md:text-2xl text-pink-600 font-bold">Since you pressed YES,<br>Please DM me! üíå</p>
            </div>
        </div>

    </div>

    <script>
        // Use DOMContentLoaded to ensure elements exist before accessing them
        document.addEventListener("DOMContentLoaded", () => {
            const canvas = document.getElementById('effects-canvas');
            
            if (!canvas) {
                console.error("Canvas element not found!");
                return;
            }

            const ctx = canvas.getContext('2d');
            const noBtn = document.getElementById('noBtn');
            const yesBtn = document.getElementById('yesBtn');
            const card = document.getElementById('proposal-card');
            const successMsg = document.getElementById('success-msg');
            const resetGameBtn = document.getElementById('resetGameBtn');
            const noBubble = document.getElementById('noBubble');
            const bubbleText = document.getElementById('bubbleText');
            
            let width, height;
            let particles = [];
            let interactionCount = 0;
            let bubbleTimeout;
            
            // Resize canvas
            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resize);
            resize();

            // --- PARTICLE SYSTEM (HEARTS) ---
            class Heart {
                constructor(x, y, type = 'fountain') {
                    this.x = x;
                    this.y = y;
                    this.type = type; // 'fountain' or 'rain'
                    
                    const sizeBase = width < 600 ? 15 : 25;
                    this.size = Math.random() * sizeBase + 10;
                    
                    // Random colors
                    const colors = ['#ff0000', '#ff1493', '#ff69b4', '#ff4500', '#db7093'];
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Physics
                    if (type === 'explosion') {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = Math.random() * 10 + 2;
                        this.vx = Math.cos(angle) * speed;
                        this.vy = Math.sin(angle) * speed;
                        this.gravity = 0.2;
                    } else if (type === 'rain') {
                        this.vx = Math.random() * 2 - 1;
                        this.vy = Math.random() * 3 + 2;
                        this.gravity = 0.05;
                    }
                    
                    this.rotation = Math.random() * 360;
                    this.rotationSpeed = (Math.random() - 0.5) * 4;
                    this.opacity = 1;
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += this.gravity;
                    this.rotation += this.rotationSpeed;
                    
                    if (this.type === 'explosion') {
                        this.opacity -= 0.005;
                    }
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.rotation * Math.PI / 180);
                    
                    // Draw Heart Shape
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    // Standard heart drawing logic
                    const s = this.size / 100; // scale
                    ctx.scale(s, s);
                    ctx.beginPath();
                    ctx.bezierCurveTo(-40, -50, -90, -30, -90, 20);
                    ctx.bezierCurveTo(-90, 80, 0, 140, 0, 140);
                    ctx.bezierCurveTo(0, 140, 90, 80, 90, 20);
                    ctx.bezierCurveTo(90, -30, 40, -50, 0, 0);
                    ctx.fill();
                    
                    ctx.restore();
                }
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);
                
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.update();
                    p.draw();
                    
                    // Remove off-screen or invisible particles
                    if (p.y > height + 100 || p.opacity <= 0) {
                        particles.splice(i, 1);
                    }
                }
                
                // Add rain occasionally
                if (isRaining) {
                    if (Math.random() < 0.3) { // Density of rain
                        particles.push(new Heart(Math.random() * width, -50, 'rain'));
                    }
                }
                
                requestAnimationFrame(animate);
            }

            // --- BUTTON LOGIC ---
            
            function moveButton(e) {
                // Check if user is trying to tap on mobile
                if(e && e.type === 'touchstart') e.preventDefault();
                
                // Capture pointer location for distance calculation
                let pointerX = 0, pointerY = 0;
                if (e.touches && e.touches.length > 0) {
                    pointerX = e.touches[0].clientX;
                    pointerY = e.touches[0].clientY;
                } else if (e.clientX !== undefined) {
                    pointerX = e.clientX;
                    pointerY = e.clientY;
                }

                interactionCount++;

                // TRICK LOGIC:
                // After 5 attempts, there's a 20% chance it turns into a YES button
                if (interactionCount > 5 && Math.random() < 0.2) {
                    
                    // Hide bubble immediately if trick happens
                    noBubble.style.opacity = '0';

                    // Determine Outcome Randomly
                    const rand = Math.random();
                    
                    // 1. Clean up events (stop moving)
                    noBtn.removeEventListener('mouseenter', moveButton);
                    noBtn.removeEventListener('touchstart', moveButton);
                    noBtn.removeEventListener('click', moveButton);
                    
                    // 2. Add Success Event
                    noBtn.addEventListener('click', triggerLoveBomb);
                    // Ensure it's clickable (re-enable pointer events if they were disabled)
                    noBtn.style.pointerEvents = 'auto';

                    // 3. Show the Reset/Play Again button on the main card
                    if(resetGameBtn) resetGameBtn.classList.remove('hidden');
                    
                    // 4. Base styles for the transformed button
                    noBtn.style.transition = "all 0.3s ease";
                    noBtn.style.transform = "scale(1.1)";
                    noBtn.style.boxShadow = "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)";

                    // Logic adjusted: Removed "Standard Trick", only kept Surrender and Loki Mischief
                    if (rand < 0.5) {
                        // OUTCOME A: Surrender
                        noBtn.innerText = "Okay okay... YES! üè≥Ô∏è";
                        noBtn.style.background = "linear-gradient(to right, #ec4899, #db2777)"; // Pinkish
                        noBtn.style.color = "white";
                        noBtn.style.borderColor = "#be185d";
                        
                    } else {
                        // OUTCOME B: LOKI MISCHIEF
                        // Setting innerHTML to include the SVG Line Art
                        noBtn.innerHTML = `
                            <div class="flex flex-col items-center justify-center leading-none py-1">
                                <svg class="w-10 h-10 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v5m0 0v-5m0 0a3 3 0 013 3v2a3 3 0 01-3 3m-3-3v-2a3 3 0 013-3z M7 14c-3-2-5-9-1-12 M17 14c3-2 5-9 1-12" />
                                </svg>
                                <span class="text-xs sm:text-sm font-bold text-center px-1">You have fallen in Loki's trick:<br>It was always a YES button!</span>
                            </div>
                        `;
                        // Loki Colors (Dark Green & Gold)
                        noBtn.style.background = "#1a2e05"; 
                        noBtn.style.color = "#fbbf24"; 
                        noBtn.style.borderColor = "#fbbf24";
                        noBtn.style.borderWidth = "2px";
                    }
                    
                    return; // Stop the move function
                }

                // Standard Runaway Logic
                
                // --- MOBILE FIX: Ghost Button ---
                // Temporarily disable clicks on the button to prevent accidental touches
                // immediately after it moves (double-tap protection)
                noBtn.style.pointerEvents = 'none';
                setTimeout(() => {
                    noBtn.style.pointerEvents = 'auto';
                }, 400); // 400ms "ghost" time
                
                // --- SMOOTHNESS FIX: Prevent Layout Shift ---
                // If the button is not yet absolute, insert a placeholder to keep the layout stable
                if (noBtn.style.position !== 'absolute') {
                    const spacer = noBtn.cloneNode(true);
                    spacer.id = 'noBtn-spacer';
                    spacer.style.visibility = 'hidden'; // Hide it
                    spacer.style.position = 'static'; // Keep it in flow
                    spacer.style.pointerEvents = 'none'; // No interactions
                    noBtn.parentNode.insertBefore(spacer, noBtn);
                    
                    noBtn.style.position = 'absolute';
                    noBtn.style.zIndex = 1000;
                }

                const btnWidth = noBtn.offsetWidth;
                const btnHeight = noBtn.offsetHeight;
                
                // Get Yes Button position relative to Card to detect overlap
                const yesRect = yesBtn.getBoundingClientRect();
                const cardRect = card.getBoundingClientRect();
                
                // Pointer relative to card
                const pointerRelX = pointerX - cardRect.left;
                const pointerRelY = pointerY - cardRect.top;

                const yesRel = {
                    left: yesRect.left - cardRect.left,
                    top: yesRect.top - cardRect.top,
                    width: yesRect.width,
                    height: yesRect.height
                };
                
                // Gap to keep distance between buttons
                const gap = 20;
                // Minimum distance from pointer to be considered "far"
                const minPointerDistance = 150;

                // Use the card's dimensions instead of the window
                // Calculate safe ranges within the card
                // Padding of 20px to keep away from edges
                const xRange = card.clientWidth - btnWidth - 40;
                const yRange = card.clientHeight - btnHeight - 40;
                
                const safeX = Math.max(0, xRange);
                const safeY = Math.max(0, yRange);
                
                let randomX, randomY;
                let validPosition = false;
                let attempts = 0;

                // Attempt to find a non-overlapping position up to 100 times
                // We added a check for distance from pointer
                while (!validPosition && attempts < 100) {
                    attempts++;
                    
                    randomX = Math.random() * safeX + 20;
                    randomY = Math.random() * safeY + 20;
                    
                    // Collision Detection (Axis-Aligned Bounding Box)
                    const noLeft = randomX;
                    const noRight = randomX + btnWidth;
                    const noTop = randomY;
                    const noBottom = randomY + btnHeight;
                    
                    const yesLeft = yesRel.left - gap;
                    const yesRight = yesRel.left + yesRel.width + gap;
                    const yesTop = yesRel.top - gap;
                    const yesBottom = yesRel.top + yesRel.height + gap;
                    
                    // Check if they overlap with YES button
                    const isOverlapping = !(noRight < yesLeft || 
                                          noLeft > yesRight || 
                                          noBottom < yesTop || 
                                          noTop > yesBottom);
                    
                    // Check distance from pointer (center of button)
                    const btnCenterX = randomX + btnWidth/2;
                    const btnCenterY = randomY + btnHeight/2;
                    const distFromPointer = Math.sqrt(
                        Math.pow(btnCenterX - pointerRelX, 2) + 
                        Math.pow(btnCenterY - pointerRelY, 2)
                    );

                    const isFarEnough = distFromPointer > minPointerDistance;

                    // Valid if no overlap AND (it is far enough OR we tried too many times)
                    if (!isOverlapping && (isFarEnough || attempts > 50)) {
                        validPosition = true;
                    }
                }

                // Set position to absolute (relative to the card parent)
                noBtn.style.position = 'absolute';
                noBtn.style.left = randomX + 'px';
                noBtn.style.top = randomY + 'px';
                noBtn.style.zIndex = 100;
                
                // NO TEXT CHANGE - Button stays as "No üò¢"

                // --- BUBBLE LOGIC ---
                // Show cheeky message in the bubble above the button
                const texts = ["Nope!", "Try Again!", "Too Slow!", "Cant Catch Me!", "Seriously?", "Just Click Yes!", "Nice Try!"];
                bubbleText.innerText = texts[Math.floor(Math.random() * texts.length)];
                
                // Position Bubble Above Button
                // The bubble is absolute within the card, just like the button
                // We center it horizontally relative to the button
                const bubbleWidth = noBubble.offsetWidth || 100; // approximation if hidden
                const bubbleHeight = noBubble.offsetHeight || 40;
                
                noBubble.style.left = (randomX + btnWidth/2 - bubbleWidth/2) + 'px'; // Actually we use transform to center, so just center point
                noBubble.style.left = (randomX + btnWidth/2) + 'px';
                noBubble.style.top = (randomY - 50) + 'px'; // 50px above
                noBubble.style.transform = "translateX(-50%)"; // Center horizontally
                
                noBubble.style.opacity = '1';

                // Reset timer to hide bubble
                clearTimeout(bubbleTimeout);
                bubbleTimeout = setTimeout(() => {
                    noBubble.style.opacity = '0';
                }, 1500);
            }

            // --- LOVE BOMB LOGIC ---
            function triggerLoveBomb() {
                // 1. Hide card logic
                card.style.opacity = '0';
                card.style.transform = 'scale(0.8)';
                setTimeout(() => card.style.display = 'none', 500);

                // 2. Show Success
                successMsg.classList.remove('hidden-transition');
                successMsg.classList.add('visible-transition');
                successMsg.style.display = 'flex';

                // 3. Explode Hearts from center
                for (let i = 0; i < 200; i++) {
                    particles.push(new Heart(width / 2, height / 2, 'explosion'));
                }
                
                // 4. Start Rain
                isRaining = true;
                
                // 5. Change BG color slowly
                document.body.style.transition = "background 3s ease";
                document.body.style.background = "linear-gradient(180deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)";
            }

            // Attach events using JS
            if (noBtn) {
                noBtn.addEventListener('mouseenter', moveButton);
                noBtn.addEventListener('touchstart', moveButton);
                noBtn.addEventListener('click', moveButton);
            }

            if (yesBtn) {
                yesBtn.addEventListener('click', triggerLoveBomb);
            }
        });
    </script>
</body>
</html>
